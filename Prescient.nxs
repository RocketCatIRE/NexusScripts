{"name":"prescient","enabled":true,"description":"Knowing the unknowable","type":"group","id":1,"items":[{"type":"function","name":"README","enabled":true,"id":2,"code":"/*\n  A thirst for knowing when Nexus changes its variables:\n  \n  First step is to maintain the original code\n  Second step is fire an event when the interloper is new\n\n  Then to use:\n  \n   $(document).off('prescient')\n   $(document).on(\"prescient\", function() {\n     // your code here\n   })\n\n  // Original Client Function\n  // TODO: this is terrible\n  var set_variable = function(name, value)\n  {\n    if (typeof name != 'string') return;\n    if (name.indexOf ('\"') >= 0) return;\n    if (name.indexOf ('\\\\') >= 0) return;\n    name = name.trim();\n    if (name[0] == '@') name = name.substr(1);\n\n    client.vars[name] = value;\n  }\n */"},{"type":"function","name":"onLoad","enabled":true,"id":3,"code":"pre = typeof pre != 'undefined' ? pre : {}\n\npre.init = function() {\n  // rewrite the client.set_variable\n  //    thankfully, the function is simple & doesn't invoke any scoped-out variables\n   \n  client.set_variable = function(name, value) {\n    if (typeof name != 'string') { return }\n    if (name.indexOf('\"') >= 0)  { return }\n    if (name.indexOf('\\\\') >= 0) { return }\n    name = name.trim()\n    \n    var old = client.vars[name]\n    client.vars[name] = value\n    if (client.vars[name] != old) { $(document).trigger('prescient', [name, client.vars[name], old]) }\n    // Personally would prefer it earlier but no insurance people won't go (trigger => retrieve variable [old])\n  }\n  \n  // remember that we call this every time we reload the script, so we have to tidy up our mess\n  //   in this case, we overwrite our master call to 'prescient'\n  \n  $(document).off('prescient')\n    \n  // We create a master trigger so we can keep it clean\n  $(document).on(\"prescient\", function(e) {\n     var name = arguments[1]\n     var newv = arguments[2]\n     var oldv = arguments[3]\n     // your code here\n     switch(name) {\n       case 'tar':\n         console.log('Target changed from ' + oldv + ' to ' + newv + '.')\n         break;\n       default:\n         break;\n     }\n  })\n}\n\npre.init()\n"}]}