{"name":"sally","enabled":true,"description":"Show all Aliases","type":"group","id":1,"items":[{"type":"function","name":"onLoad","enabled":true,"id":2,"code":"sally = typeof sally != 'undefined' ? sally : {}\n\nsally.class  = \"sally\"\n\nsally.write  = function(msg)  { ow_Write('#output_main', msg) } // Nexus write\nsally.inject = function(rule) { $('body').append('<div class=\"' + sally.class + '\">&shy;<style>' + rule + '</style></div>') }\nsally.lpad   = function(str, len, char) { if (typeof str == 'number') { str = str.toString() }; if (char == null) { char = ' ' }; var r = len - str.length; if (r < 0) { r = 0 }; return char.repeat(r) + str }\nsally.rpad   = function(str, len, char) { if (typeof str == 'number') { str = str.toString() }; if (char == null) { char = ' ' }; var r = len - str.length; if (r < 0) { r = 0 }; return str + char.repeat(r) }\n\nsally.loop = function(arr) {\n  var out = []\n  if (arr.type == 'alias') { return [arr] }\n  if (arr.type == 'group') { for (var i = 0; i < arr.items.length; i++) { out = out.concat(sally.loop(arr.items[i])) }; return out }\n  if (arr instanceof Array) { for (var i = 0; i < arr.length; i++) { out = out.concat(sally.loop(arr[i])) }; return out }\n  return out\n}\n\nsally.display = function(arr, filter) {\n  // sort arr by id\n  arr.sort( sally.chainSortBy([\n   sally.sort_by('id', true, null),\n   sally.sort_by('name', true, null)\n  ]) )\n  console.log(arr)\n  \n  // style rules\n  $('.' + sally.class).remove()\n  sally.inject('.sally-mute { color: rgba( 67, 67, 67, 1 ); }')\n  \n  var c   = 0\n  var str = '<br>'\n  if (typeof filter == 'string') { str += '<div id=\"sally-alias\" class=\"mono\"><span class=\"sally-mute\">Searching </span>' + arr.length + '<span class=\"sally-mute\"> aliases for </span>' + filter + '<span class=\"sally-mute\">: </span></div><br>' }\n  for (var i = 0; i < arr.length; i++) {\n    var m    = arr[i]\n    var name = m.name; if (name == '') { name = 'unnamed' }\n    if (typeof filter == 'string') {\n      if (name.match(filter) || m.text.match(filter) ) {\n        c += 1\n        str += '<div id=\"sally-alias\" class=\"mono\"><span class=\"sally-mute\"> (' + sally.lpad(m.id, 4) + ') ' + sally.rpad( name.substring(0, 23), 23 ) + ' &ddagger; </span>' + m.text + '</div>'\n      }\n    } else {\n      str += '<div id=\"sally-alias\" class=\"mono\"><span class=\"sally-mute\"> (' + sally.lpad(m.id, 4) + ') ' + sally.rpad( name.substring(0, 23), 23 ) + ' &ddagger; </span>' + m.text + '</div>'\n    }\n  }\n  if (typeof filter == 'string') {\n    str += '<br><div id=\"sally-alias\" class=\"mono\"><span class=\"sally-mute\">Matched </span>' + filter + '<span class=\"sally-mute\"> in </span>' + c + '<span class=\"sally-mute\"> of </span>' + arr.length + '<span class=\"sally-mute\"> aliases.</span></div>'\n  } else {\n    str += '<br><div id=\"sally-alias\" class=\"mono\"><span class=\"sally-mute\">Displaying </span>' + arr.length + '<span class=\"sally-mute\"> aliases.</span></div>'\n  }\n  str += '<br>'\n  sally.write('<div id=\"sally-alias\">' + str + '</div>')\n}\n\n// UTILITY\n\n/* https://stackoverflow.com/a/27645164 */\nsally.sort_by = function(field, reverse, primer){\n    var key = primer ? \n         function(x) {return primer(x[field]); }:\n         function(x) {return x[field] };\n    reverse = [-1, 1][+!!reverse];\n    return function (a, b) {\n        a = key(a);\n        b = key(b);\n        return a==b ? 0 : reverse * ((a > b) - (b > a)); //^ Return a zero if the two fields are equal!\n    } }\n\nsally.chainSortBy = function(sortByArr) {\n    return function(a, b) {\n        for (var i=0; i<sortByArr.length; i++) {\n            var res = sortByArr[i](a,b);\n            if (res != 0)\n                return res; //If the individual sort_by returns a non-zero,\n                            //we found inequality, return the value from the comparator.\n        }\n        return 0;\n    } }\n"},{"type":"alias","name":".sal, show aliases","enabled":true,"id":3,"matching":"regexp","whole_words":true,"case_sensitive":true,"prefix_suffix":true,"actions":[{"action":"script","script":"sally.display(sally.loop(client.packages))"}],"text":"^\\.sal$"},{"type":"alias","name":".sal filter","enabled":true,"id":4,"matching":"regexp","whole_words":true,"case_sensitive":true,"prefix_suffix":true,"actions":[{"action":"script","script":"var matches = arguments[0]\nvar filter  = matches[1]\n\nsally.display(sally.loop(client.packages), filter)"}],"text":"^\\.sal[ ]+(.*)$"}]}